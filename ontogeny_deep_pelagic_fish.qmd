---
title: "Ontogeny of deep pelagic fish"
format: 
  html:
    self-contained: true
    code-fold: true
editor: visual
theme: minty
execute:
  warning: false
  message : false
toc: true
toc-title: Sections
toc-location: left
page-layout: full
---

# Questions 

- Are there species that present ontogenetic shifts in their size distribution as a function of depth?

- Is there a linear relationship between the size of individuals and their $\delta$<sup>15</sup>N values at the community level? Within the different depth layers (epipelagic, upper-mesopelagic, lower-mesopelagic and bathypelagic)? At the specific level (increase in trophic level and therefore change in diet over the course of life)?

- At the specific level, are the values in $\delta$<sup>15</sup>N more influenced by the depth (due to bacterial degradation in particular) or by the size of the individuals (increase in the trophic level )?

- Depending on all these relationships, can we deduce typologies of species (differences in life strategies)?


# Size distribution as a function of depth

## Density plot by depth layer

-   with the complete data set (2002-2021)
-   binwidth = 1cm
-   median
-   To test the significant difference in size distribution as a function of depth: test between the depth layer or use of linear models (lm(size\~depth))?

```{r}
#| echo: false
#| fig-height: 13
#| fig-width: 20
library(tidyr)
library(ggplot2)

size_distribution_complete <- utils::read.csv(here::here("data", "size_distribution_complete.csv"), sep = ";", header = T,dec = ".")

size_distribution_complete$depth_layer <- factor(size_distribution_complete$depth_layer, 
                                  levels = c("epipelagic","upper_mesopelagic",
                                         "lower_mesopelagic","bathypelagic"),
                                  labels = c("Epipelagic","Upper mesopelagic",
                                          "Lower mesopelagic","Bathypelagic"))

size_distribution_complete$species <- factor(size_distribution_complete$species,
                                                   levels = c("Notoscopelus kroyeri",
                                                              "Myctophum punctatum",
                                                              "Melanostigma atlanticum",
                                                               "Lampanyctus crocodilus",
                                                              "Arctozenus risso",
                                                              "Xenodermichthys copei",
                                                              "Serrivomer beanii",
                                                              "Argyropelecus olfersii",
                                                              "Stomias boa",
                                                              "Searsia koefoedi",
                                                              "Aphanopus carbo",
                                                              "Lampanyctus macdonaldi"),
                                        labels = c("N.kroyeri",
                                                              "M.punctatum",
                                                              "M.atlanticum",
                                                               "L.crocodilus",
                                                              "A.risso",
                                                              "X.copei",
                                                              "S.beanii",
                                                              "A.olfersii",
                                                              "S.boa",
                                                              "S.koefoedi",
                                                              "A.carbo",
                                                              "L.macdonaldi"))

 df2 <- size_distribution_complete %>%
   dplyr::group_by(species, depth_layer) %>%
   dplyr::summarise(median_sl = median(size))

ggplot(size_distribution_complete, aes(x=size)) +
  geom_density(alpha=0.3, aes(col=depth_layer), linewidth=1)+
  geom_histogram(aes(y=..density.., col=depth_layer, fill=depth_layer), alpha=0.3, 
                 position="identity", binwidth = 1)+
  paletteer::scale_color_paletteer_d("jcolors::pal10")+
  paletteer::scale_fill_paletteer_d("jcolors::pal10")+
  facet_grid(depth_layer~species, scale="free")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=16,face="italic"),
        strip.text.y = element_text(size=17),
        axis.title = element_text(size=19),
        axis.text =  element_text(size=14, color= "grey50"),
        panel.background=element_rect(color="white"),
        legend.title = element_text(size=14),
        legend.text = element_text(size=14))+
  geom_vline(data = df2, aes(xintercept = median_sl, col= depth_layer), size= 1.3, 
             linetype="dashed") +
  guides(fill="none",col="none")+
  xlab("Standard Length (cm)")
```

## Linear models

-   Graph not to be included in the paper but results of linear relationships in the final table

```{r}
#| echo: false
#| fig-height: 15
#| fig-width: 20

ontogeny_data <- utils::read.csv(here::here("data", "ontogeny.csv"), sep = ";", header = T,dec = ",")

ontogeny_data$species <- factor(ontogeny_data$species,
                               levels = c("Stomias_boa",
                                          "Lampanyctus_crocodilus",
                                          "Myctophum_punctatum",
                                          "Aphanopus_carbo",
                                          "Melanostigma_atlanticum",
                                          "Serrivomer_beanii",
                                          "Argyropelecus_olfersii",
                                          "Lampanyctus_macdonaldi",
                                          "Searsia_koefoedi",
                                          "Notoscopelus_kroyeri",
                                          "Xenodermichthys_copei",
                                          "Arctozenus_risso"),
                               labels = c("Stomias boa",
                                          "Lampanyctus crocodilus",
                                          "Myctophum punctatum",
                                          "Aphanopus carbo",
                                          "Melanostigma atlanticum",
                                          "Serrivomer beanii",
                                          "Argyropelecus olfersii",
                                          "Lampanyctus macdonaldi",
                                          "Searsia koefoedi",
                                          "Notoscopelus kroyeri",
                                          "Xenodermichthys copei",
                                          "Arctozenus risso"))

ggplot(ontogeny_data , aes(x=trawling_depth, y=size))+
  geom_point (alpha=0.4, col="black", size=3) + 
  geom_smooth(method=lm, se=T, alpha=0.2, col= alpha("darkblue",0.7), size= 1.5) +
  facet_wrap(~species, scale = "free", ncol=3)+ 
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.. 
                                          , ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size= 6,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  ylab("Standard length (cm)")+
  xlab("Trawling depth (m)")+
  guides(color="none", fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=20,face="italic"),
        axis.title = element_text(size=20),
        axis.text =  element_text(size=20))

```

# $\delta$<sup>15</sup>N-size relationships

## At community level

-   X axis (size) in log

```{r}
#| echo: false

ggplot(ontogeny_data , aes(x=size, y=d15N_muscle_untreated))+
  geom_point (alpha=0.4) + 
  geom_smooth(method=lm, se=T, alpha=0.2, col= alpha("darkblue",0.7)) + 
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.. 
                                          , ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size=3,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  scale_x_continuous(trans = 'log2') +
  xlab(bquote(log[2]~"standard length (cm)"))+
  ylab(expression({delta}^15*N~'\u2030'))+
  ylim(c(7,13))+
  guides(fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=10,face="italic"),
        axis.title = element_text(size=10),
        axis.text =  element_text(size=10))
```

## At community level - by depth layer

-   X axis (size) in log<sub>2</sub>
-   All axis fixed

```{r}
#| echo: false
#| fig-height: 7
#| fig-width: 11

ontogeny_data$depth_layer <- factor(ontogeny_data$depth_layer, 
                                  levels = c("epipelagic","upper_mesopelagic",
                                         "lower_mesopelagic","bathypelagic"),
                                  labels = c("Epipelagic","Upper mesopelagic",
                                          "Lower mesopelagic","Bathypelagic"))

ggplot(ontogeny_data , aes(x=size, y=d15N_muscle_untreated))+
  geom_point (alpha=0.7, aes(col=depth_layer)) + 
  geom_smooth(method=lm, se=T, alpha=0.2, aes(col=depth_layer, fill= depth_layer)) +
  facet_wrap(~depth_layer, ncol=2)+ 
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.. 
                                          , ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size=3,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  scale_x_continuous(trans = 'log2') +
  xlab(bquote(log[2]~"standard length (cm)"))+
  paletteer::scale_color_paletteer_d("jcolors::pal10")+
  paletteer::scale_fill_paletteer_d("jcolors::pal10")+
 # xlab("Standard Length (cm)")+
  ylab(expression({delta}^15*N~'\u2030'))+
  ylim(c(7,13))+
  guides(color="none", fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=10),
        axis.title = element_text(size=10),
        axis.text =  element_text(size=10))
```

## At species level

-   $\delta$<sup>15</sup>N axis standardized

```{r}
#| echo: false
#| warning: false
#| fig-height: 10
#| fig-width: 10

library(ggplot2)

ontogeny_significant <- subset(ontogeny_data, species=="Lampanyctus crocodilus"|
                                         species=="Aphanopus carbo"|
                                         species=="Melanostigma atlanticum" |
                                         species=="Serrivomer beanii"|
                                         species=="Stomias boa"|
                                         species=="Myctophum punctatum"|
                                         species=="Arctozenus risso")

ontogeny_significant$species <- factor(ontogeny_significant$species,
                               levels = c("Myctophum punctatum",
                                          "Melanostigma atlanticum",
                                          "Lampanyctus crocodilus",
                                          "Stomias boa",
                                          "Serrivomer beanii",
                                          "Aphanopus carbo",
                                          "Arctozenus risso"))

ggplot(ontogeny_significant , aes(x=size, y=d15N_muscle_untreated))+
  geom_point (alpha=0.4, col="black") + 
  geom_smooth(method=lm, se=T, alpha=0.2, col= alpha("darkblue",0.7)) +
  facet_wrap(~species, scale="free_x", ncol=3)+ 
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.. 
                                          , ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size=3,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  xlab("Standard Length (cm)")+
  ylab(expression({delta}^15*N~'\u2030'))+
  ylim(c(7,13))+
  guides(color="none", fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=10,face="italic"),
        axis.title = element_text(size=10),
        axis.text =  element_text(size=10))

```

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 10
ontogeny_non_significant <- subset(ontogeny_data, species=="Argyropelecus olfersii"|
                                 species=="Lampanyctus macdonaldi"|
                                 species=="Searsia koefoedi" |
                                 species=="Notoscopelus kroyeri"|
                                 species=="Xenodermichthys copei")

ontogeny_non_significant$species <- factor(ontogeny_non_significant$species,
                                       levels = c("Argyropelecus olfersii",
                                                  "Lampanyctus macdonaldi",
                                                  "Searsia koefoedi",
                                                  "Notoscopelus kroyeri",
                                                  "Xenodermichthys copei"))

ggplot(ontogeny_non_significant , aes(x=size, y=d15N_muscle_untreated))+
  geom_point (alpha=0.4, col="black") + 
  facet_wrap(~species, scale="free_x", ncol=3)+ 
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste( ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size=3,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  xlab("Standard Length (cm)")+
  ylab(expression({delta}^15*N~'\u2030'))+
  ylim(c(7,13))+
  guides(color="none", fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=10,face="italic"),
        axis.title = element_text(size=10),
        axis.text =  element_text(size=10))

```

## Variation coefficients

```{r}

cv <- function(x){
  (sd(x)/mean(x))*100
}

coeff_var <- aggregate(d15N_muscle_untreated ~ species, 
                       data = ontogeny_data,
                       FUN = cv)
DT::datatable(coeff_var)
```

# $\delta$<sup>15</sup>N in function of depth

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 8

ggplot(ontogeny_data , aes(x=trawling_depth, y=d15N_muscle_untreated))+
  geom_point (alpha=0.4) + 
  geom_smooth(method=lm, se=T, alpha=0.2, col= "darkblue") +
  ggpmisc::stat_poly_eq(formula = y ~ x, 
                        aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.. 
                                          , ..n.label..,sep = "*`,`~")),
                        parse = TRUE,
                        size=3,
                        label.x.npc = "right",
                        label.y.npc = "bottom",
                        vstep = -0.0005)+ 
  xlab("Trawling depth (m)")+
  ylab(expression({delta}^15*N~'\u2030'))+
  guides(color="none", fill="none")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=10),
        axis.title = element_text(size=10),
        axis.text =  element_text(size=10))
```

# Variation partitionning

## *Lampanyctus crocodilus*

```{r}
#| echo: true
#| warning: false 
#| fig-height: 6
#| fig-width: 6

#Varpart
lamp_cro <- subset (ontogeny_data, ontogeny_data$species == "Lampanyctus crocodilus")
lamp_cro_part <- vegan::varpart(lamp_cro$d15N_muscle_untreated,
                            ~trawling_depth, ~size, data =lamp_cro)
lamp_cro_part$part

plot(lamp_cro_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

### Significance testing

#### \[a\] Depth alone

```{r}
vegan::anova.cca(vegan::rda(lamp_cro$d15N_muscle_untreated, lamp_cro$trawling_depth, lamp_cro$size))
```

#### \[c\] Size alone

```{r}
vegan::anova.cca(vegan::rda(lamp_cro$d15N_muscle_untreated, lamp_cro$size, lamp_cro$trawling_depth))
```

## *Myctophum punctatum*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
myct_pun <- subset(ontogeny_data, ontogeny_data$species == "Myctophum punctatum")
myct_pun_part <- vegan::varpart(myct_pun$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data =myct_pun)
plot(myct_pun_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # color the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(myct_pun$d15N_muscle_untreated, myct_pun$trawling_depth, myct_pun$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(myct_pun$d15N_muscle_untreated, myct_pun$size, myct_pun$trawling_depth))
```

## *Melanostigma atlanticum*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
mela_atl <- subset(ontogeny_data, ontogeny_data$species == "Melanostigma atlanticum")
mela_atl_part <- vegan::varpart(mela_atl$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = mela_atl)
plot(mela_atl_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)

```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(mela_atl$d15N_muscle_untreated, mela_atl$trawling_depth,
                            mela_atl$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(mela_atl$d15N_muscle_untreated, mela_atl$size,
                            mela_atl$trawling_depth))
```

## *Serrivomer beanii*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
serr_bea <- subset(ontogeny_data, ontogeny_data$species == "Serrivomer beanii")
serr_bea_part <- vegan::varpart(serr_bea$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = serr_bea)
plot(serr_bea_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)

```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(serr_bea$d15N_muscle_untreated, serr_bea$trawling_depth,
                            serr_bea$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(serr_bea$d15N_muscle_untreated, serr_bea$size,
                            serr_bea$trawling_depth))
```

## *Argyropelecus olfersii*

```{r}
#| echo: false
#| warning: false
#| #| fig-height: 6
#| fig-width: 6

#Varpart
argy_olf <- subset(ontogeny_data, ontogeny_data$species == "Argyropelecus olfersii")
argy_olf_part <- vegan::varpart(argy_olf$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = argy_olf)
plot(argy_olf_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(argy_olf$d15N_muscle_untreated, argy_olf$trawling_depth,
                            argy_olf$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(argy_olf$d15N_muscle_untreated, argy_olf$size,
                            argy_olf$trawling_depth))
```

## *Lampanyctus macdonaldi*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
lamp_mac <- subset(ontogeny_data, ontogeny_data$species == "Lampanyctus macdonaldi")
lamp_mac_part <- vegan::varpart(lamp_mac$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = lamp_mac)
plot(lamp_mac_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)

```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(lamp_mac$d15N_muscle_untreated, lamp_mac$trawling_depth,
                            lamp_mac$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(lamp_mac$d15N_muscle_untreated, lamp_mac$size,
                            lamp_mac$trawling_depth))
```

## *Searsia koefoedi*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
sear_koe <- subset(ontogeny_data, ontogeny_data$species == "Searsia koefoedi")
sear_koe_part <- vegan::varpart(sear_koe$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = sear_koe)
plot(sear_koe_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(sear_koe$d15N_muscle_untreated, sear_koe$trawling_depth,
                            sear_koe$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(sear_koe$d15N_muscle_untreated, sear_koe$size,
                            sear_koe$trawling_depth))
```

## *Notoscopelus kroyeri*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
noto_kro <- subset(ontogeny_data, ontogeny_data$species == "Notoscopelus kroyeri")
noto_kro_part <- vegan::varpart(noto_kro$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = noto_kro)
plot(noto_kro_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(noto_kro$d15N_muscle_untreated, noto_kro$trawling_depth,
                            noto_kro$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(noto_kro$d15N_muscle_untreated, noto_kro$size,
                            noto_kro$trawling_depth))
```

## *Xenodermichthys copei*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
xeno_cop <- subset(ontogeny_data, ontogeny_data$species == "Xenodermichthys copei")
xeno_cop_part <- vegan::varpart(xeno_cop$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = xeno_cop)
plot(xeno_cop_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(xeno_cop$d15N_muscle_untreated, xeno_cop$trawling_depth,
                            xeno_cop$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(xeno_cop$d15N_muscle_untreated, xeno_cop$size,
                            xeno_cop$trawling_depth))
```

## *Arctozenus risso*

```{r}
#| echo: false
#| warning: false
#| fig-height: 6
#| fig-width: 6

#Varpart
arct_ris <- subset(ontogeny_data, ontogeny_data$species == "Arctozenus risso")
arct_ris_part <- vegan::varpart(arct_ris$d15N_muscle_untreated,
                                ~trawling_depth, ~size, data = arct_ris)
plot(arct_ris_part,
     Xnames = c("Depth", "size"), # name the partitions
     bg = c("#072AC8", "#0B5345"), alpha = 100, # colour the circles
     digits = 2, # only show 2 digits
     cex = 1.4)
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(arct_ris$d15N_muscle_untreated, arct_ris$trawling_depth,
                            arct_ris$size))
```

```{r}
#| echo: false
#| output: false
vegan::anova.cca(vegan::rda(arct_ris$d15N_muscle_untreated, arct_ris$size,
                            arct_ris$trawling_depth))
```

```{r}
#| echo: false
#| warning: false 
## For all species at once 
# ontogeny_summary <- ontogeny_data %>%
#   group_by(species) %>%
#   summarise(vegan::varpart(ontogeny_data$d15N_muscle_untreated,
#                          ~trawling_depth, ~size, data =.)) 
```

# Summary table

**Testing significance:**

-   $\delta$<sup>15</sup>N - Size & $\delta$<sup>15</sup>N - depth : use of the anova.cca() function to test the significance of each part separately (depth & size) on the variability of $\delta$<sup>15</sup>N values
-   Depth - size : test with linear model lm (size\~depth)
-   *Stomias boa* & *Aphanopus carbo* \* depth range too small (\< 100m) so no use of variance partition models on these species, but linear models $\delta$<sup>15</sup>N - size significant

![Summary table](summary_table.jpg){width="70%"}

# Limits

## Test of temporal variability on $\delta$<sup>15</sup>N values

-   Difficult to test because it is necessary to eliminate the biases due to size and depth.
-   However, over 90% of the sampling has been completed between 2019 and 2021 (and almost 3/4 in 2021)
-   If major environmental changes had occurred that significantly altered the baseline over time, this would have been observed in all species in the same way, which does not appear to be the case here
-  Test with *Lampnyctus crocodilus*: In the bathypelagic layer and individuals between 10 and 12cm : non signifiant differences 

```{r}
#| echo: false
#| warning: false 
#| fig-height: 18
#| fig-width: 25

ontogeny_data$years <- as.character(ontogeny_data$years)

ggplot(ontogeny_data , aes(x=size, y=d15N_muscle_untreated))+
  geom_point (alpha=0.7, aes(col=years), size=4) + 
  paletteer::scale_color_paletteer_d("ggsci::default_ucscgb")+
  facet_wrap(~species, scale="free_x")+ 
  xlab("Standard Length (cm)")+
  ylab(expression({delta}^15*N~'\u2030'))+
  theme_minimal()+
  theme(strip.text.x = element_text(size=22,face="italic"),
        axis.title = element_text(size=22),
        axis.text =  element_text(size=22),
        legend.title = element_text(size=22),
        legend.text = element_text(size=22))

```

## Representativeness of the sampling of individuals for $\delta$<sup>15</sup>N values

-  In supplementary material ?

```{r}
#| echo: false
#| warning: false 
#| fig-height: 10
#| fig-width: 20

ggplot(size_distribution_complete, aes(x=size)) +
  geom_density(alpha=0.3, linewidth=0.7, aes(col=dataset, fill= dataset))+
  scale_color_manual(values = c("#6FB668", "#A070FF"), labels = c("Individuals sampled isotopy", "Total"))+
  scale_fill_manual(values = c("#6FB668", "#A070FF"), labels = c("Individuals sampled isotopy", "Total"))+
  facet_wrap(~species, scale="free")+
  theme_minimal()+
  theme(strip.text.x = element_text(size=16,face="italic"),
        strip.text.y = element_text(size=17),
        axis.title = element_text(size=19),
        axis.text =  element_text(size=14, color= "grey50"),
        panel.background=element_rect(color="white"),
        legend.title = element_text(size=19),
        legend.text = element_text(size=19))+
  xlab("Standard length (cm)")+
  guides(fill=guide_legend(title="Dataset"), col=guide_legend(title="Dataset"))
```


